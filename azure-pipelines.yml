trigger:
  branches:
    include:
      - main

pool:
  name: Default   # Tu agente local

variables:
  imageName: 'jrebaza01/app-week1'     # Tu repo en Docker Hub
  tag: $(Build.SourceVersion)          # Tag dinámico basado en commit

steps:
# 1️⃣ Checkout del código
- checkout: self

# 2️⃣ Login en Docker Hub usando tu Service Connection
- task: Docker@2
  displayName: 'Login to Docker Hub'
  inputs:
    command: login
    containerRegistry: 'DockerHubService'   # Tu conexión ya creada

# 3️⃣ Build de la imagen Docker
- task: Docker@2
  displayName: 'Build Docker image'
  inputs:
    command: build
    Dockerfile: '$(Build.SourcesDirectory)/app/Dockerfile'     # Ruta correcta (usa /)
    buildContext: '$(Build.SourcesDirectory)/app'
    tags: |
      $(imageName):$(tag)

# 4️⃣ Push de la imagen a Docker Hub
- task: Docker@2
  displayName: 'Push Docker image'
  inputs:
    command: push
    containerRegistry: 'DockerHubService'   # Importante mantener esto
    tags: |
      $(imageName):$(tag)
