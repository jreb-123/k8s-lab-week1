trigger:
  branches:
    include:
      - main

pool:
  name: Default

variables:
  imageName: 'jrebaza01/app-week1'   # Cambia al nombre de tu repositorio Docker
  tag: $(Build.SourceVersion)

steps:

# 1️⃣ Checkout del código
- task: Checkout@1

# 2️⃣ Login a Docker Hub usando la service connection
- task: Docker@2
  displayName: 'Login to Docker Hub'
  inputs:
    command: login
    containerRegistry: 'DockerHubService'   # Tu service connection
    loginServer: 'https://index.docker.io/v1/'  # Docker Hub

# 3️⃣ Build de la imagen
- task: Docker@2
  displayName: 'Build Docker image'
  inputs:
    command: build
    Dockerfile: '$(Build.SourcesDirectory)\app\Dockerfile'  # Ruta a tu Dockerfile
    tags: '$(imageName):$(tag)'
    buildContext: '$(Build.SourcesDirectory)\app'

# 4️⃣ Push de la imagen
- task: Docker@2
  displayName: 'Push Docker image'
  inputs:
    command: push
    tags: '$(imageName):$(tag)'
