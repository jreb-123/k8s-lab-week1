- powershell: |
    Write-Host "Actualizando values.yaml con el nuevo tag..."

    # Actualiza el tag en values.yaml
    (Get-Content "$(Build.SourcesDirectory)/charts/app/values.yaml") `
      -replace 'tag: .*', "tag: $(tag)" | Set-Content "$(Build.SourcesDirectory)/charts/app/values.yaml"

    # Configura git
    git config user.email "ci@azurepipelines.com"
    git config user.name "Azure Pipelines"

    # Define rama destino (dev o prod)
    $branch = "$(TargetBranch)"
    Write-Host "Usando la rama: $branch"

    # Trae la rama del remoto
    git fetch origin $branch
    git checkout $branch
    git pull origin $branch

    # Commit & push
    git add "$(Build.SourcesDirectory)/charts/app/values.yaml"
    git commit -m "Update image tag to $(tag)" -m "CI/CD Azure Pipelines"
    git push origin $branch
  displayName: "Update Helm values and push to GitHub"

